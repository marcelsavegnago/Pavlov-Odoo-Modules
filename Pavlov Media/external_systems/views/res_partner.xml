<odoo>

  <record id="external_systems_res_partner_form" model="ir.ui.view">
    <field name="model">res.partner</field>
    <field name="inherit_id" ref="base.view_partner_form"/>
    <field name="arch" type="xml">
      <data>

        <xpath expr="//sheet" position="before">
          <header>
            <button name="open_mimic_myaccount"
                    string="Mimic Account"
                    type="object"
                    class="oe_highlight"
                    attrs="{'invisible': [('external_systems_id', '=', False)]}"/>
          </header>
        </xpath>

        <xpath expr="//page[@name='internal_notes']" position="after">
          <page name="external_systems" string="External Systems Configurations"
                attrs="{'invisible': [('is_company','=',True)]}"
                groups="external_systems.group_external_systems_contact,
                        external_systems.group_external_systems_contact_id,
                        external_systems.group_external_systems_contact_owner">
            <group>
              <field name="external_systems_flag"
                     groups="external_systems.group_external_systems_contact"/>
              <field name="external_systems_id"
                     attrs="{'required':[('external_systems_flag', '=', True)]}"
                     groups="external_systems.group_external_systems_contact_id"/>
              <field name="owned_by"
                     attrs="{'required':[('external_systems_flag', '=', True)]}"
                     groups="external_systems.group_external_systems_contact_owner"/>
            </group>
          </page>
        </xpath>

      <xpath expr="//field[@name='name']" position="attributes">
          <field name="name" position="attributes">
            <attribute name="attrs">{'readonly':[('external_systems_flag','=',True),('owned_by', '!=', 'odoo')]}</attribute>
          </field>
        </xpath>
        <xpath expr="//field[@name='street']" position="attributes">
          <field name="street" position="attributes">
             <attribute name="attrs">{'readonly':[('external_systems_flag','=',True),('owned_by', '!=', 'odoo')]}</attribute>
          </field>
        </xpath>
        <xpath expr="//field[@name='street2']" position="attributes">
          <field name="street2" position="attributes">
             <attribute name="attrs">{'readonly':[('external_systems_flag','=',True),('owned_by', '!=', 'odoo')]}</attribute>
          </field>
        </xpath>
        <xpath expr="//field[@name='city']" position="attributes">
          <field name="city" position="attributes">
             <attribute name="attrs">{'readonly':[('external_systems_flag','=',True),('owned_by', '!=', 'odoo')]}</attribute>
          </field>
        </xpath>
        <xpath expr="//field[@name='state_id']" position="attributes">
          <field name="state_id" position="attributes">
             <attribute name="attrs">{'readonly':[('external_systems_flag','=',True),('owned_by', '!=', 'odoo')]}</attribute>
          </field>
        </xpath>
        <xpath expr="//field[@name='zip']" position="attributes">
          <field name="zip" position="attributes">
             <attribute name="attrs">{'readonly':[('external_systems_flag','=',True),('owned_by', '!=', 'odoo')]}</attribute>
          </field>
        </xpath>
        <xpath expr="//field[@name='country_id']" position="attributes">
          <field name="country_id" position="attributes">
             <attribute name="attrs">{'readonly':[('external_systems_flag','=',True),('owned_by', '!=', 'odoo')]}</attribute>
          </field>
        </xpath>
	</data>
    </field>
  </record>
</odoo>
